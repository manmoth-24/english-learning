<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Mode</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f0f2f5; }
        /* è¨ºæ–­ãƒ­ã‚°è¡¨ç¤ºã‚¨ãƒªã‚¢ï¼ˆé»’ã„ç®±ï¼‰ */
        #debug-console {
            background: #000; color: #0f0; 
            padding: 15px; margin-bottom: 20px; 
            border-radius: 8px; font-family: monospace; 
            height: 150px; overflow-y: scroll; border: 2px solid red;
        }
        .input-area { background: white; padding: 20px; border-radius: 10px; }
        input { padding: 10px; width: 70%; border: 1px solid #ccc; }
        button { padding: 10px 20px; background: blue; color: white; border: none; }
    </style>
</head>
<body>

    <h3>è¨ºæ–­ãƒ­ã‚° (ã“ã“ã«ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¾ã™)</h3>
    <div id="debug-console">System Ready...<br></div>

    <div class="input-area">
        <h3>ãƒ†ã‚¹ãƒˆé€ä¿¡</h3>
        <p>ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã€ä¸Šã®é»’ã„ç®±ã‚’è¦‹ã¦ãã ã•ã„ã€‚</p>
        <input type="text" id="message" placeholder="ãƒ†ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸">
        <button id="send-btn" onclick="trySend()">é€ä¿¡ãƒ†ã‚¹ãƒˆ</button>
    </div>

    <script>
        // --- 1. è¨ºæ–­ç”¨ãƒ„ãƒ¼ãƒ«ï¼ˆç”»é¢ã«æ–‡å­—ã‚’å‡ºã™æ©Ÿèƒ½ï¼‰ ---
        function log(msg) {
            const box = document.getElementById('debug-console');
            box.innerHTML += `> ${msg}<br>`;
            box.scrollTop = box.scrollHeight; // è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
        }

        // --- 2. ã‚¨ãƒ©ãƒ¼ã‚’ã‚­ãƒ£ãƒƒãƒã™ã‚‹è¨­å®š ---
        window.onerror = function(message, source, lineno, colno, error) {
            log(`âŒ CRITICAL ERROR: ${message}`);
            return true;
        };

        // --- 3. Supabaseè¨­å®š ---
        log("åˆæœŸåŒ–ã‚’é–‹å§‹ã—ã¾ã™...");

        // â˜…â˜…â˜… â†“ã“ã“ã ã‘æ›¸ãæ›ãˆã¦ãã ã•ã„ï¼ â˜…â˜…â˜…
        const SUPABASE_URL = "https://olmaivevtfipahmceuji.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9sbWFpdmV2dGZpcGFobWNldWppIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAwNTM1NTYsImV4cCI6MjA4NTYyOTU1Nn0.7RlnISpA9VEWXPMmz0L94l2lCemiXjHblXW8BPI_YP8";
        // â˜…â˜…â˜… â†‘ã“ã“ã ã‘æ›¸ãæ›ãˆã¦ãã ã•ã„ï¼ â˜…â˜…â˜…

        let db = null;

        try {
            if (typeof supabase === 'undefined') {
                throw new Error("Supabaseãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“ï¼");
            }
            const { createClient } = supabase;
            db = createClient(SUPABASE_URL, SUPABASE_KEY);
            log("âœ… Supabaseæ¥ç¶šæº–å‚™OK");
        } catch (e) {
            log(`âŒ è¨­å®šã‚¨ãƒ©ãƒ¼: ${e.message}`);
        }

        // --- 4. é€ä¿¡æ©Ÿèƒ½ ---
        async function trySend() {
            log("ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚Œã¾ã—ãŸ");
            
            const input = document.getElementById('message');
            const text = input.value;

            if (!text) {
                log("âš ï¸ æ–‡å­—ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“");
                return;
            }

            if (!db) {
                log("âŒ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®è¨­å®šãŒé–“é•ã£ã¦ã„ã¾ã™");
                return;
            }

            log(`ã€Œ${text}ã€ã‚’é€ä¿¡ä¸­...`);

            try {
                // post_id ã¯å›ºå®šã§ 'test' ã«ã—ã¦ã„ã¾ã™
                const { data, error } = await db
                    .from('comments')
                    .insert([{ post_id: 'test', content: text }]);

                if (error) {
                    log(`âŒ é€ä¿¡å¤±æ•— (Supabaseã‚¨ãƒ©ãƒ¼):`);
                    log(`Code: ${error.code}`);
                    log(`Message: ${error.message}`);
                    log(`Hint: ${error.hint || 'ãªã—'}`);
                } else {
                    log("ğŸ‰ é€ä¿¡æˆåŠŸï¼ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
                    input.value = "";
                }
            } catch (err) {
                log(`âŒ äºˆæœŸã›ã¬ã‚¨ãƒ©ãƒ¼: ${err.message}`);
            }
        }
    </script>
</body>
</html>
